# GEMINI 기술 인수인계 문서 (v10 - 최종)

**문서 목적**: 이 문서는 다른 Gemini AI 에이전트가 프로젝트의 기술적 맥락, 설계 결정, 개발 과정을 완벽하게 이해하고 작업을 원활하게 이어받을 수 있도록 작성되었습니다.

---
## 1. 프로젝트 개요 (최종: 국내 주식 전용)
*(기존 내용과 동일)*

---

## 2. 핵심 아키텍처 및 설계 결정 (최종)
*(기존 내용과 동일)*

---

## 3. 기능별 핵심 파일 경로 (최종)
*(기존 내용과 동일)*

---

## 4. 개발 이력 및 문제 해결 (Troubleshooting History) - **최종 회고**

*(기존 문제 해결 이력은 생략)*

- **(신규) 매매 복기 기능 전체 구현 및 디버깅**:
  - **목표**: 사용자가 자신의 투자 내역을 기록하고, 수익률을 추적하며 투자 결정을 복기할 수 있는 '매매 복기' 기능을 구현.
  - **구현 내용**:
    1.  **데이터 구조 및 Context**: `TradeLogContext`를 생성하여 `localStorage` 기반의 매매 기록 CRUD 기능을 구현.
    2.  **매매 복기 페이지 UI**: `mistakes/page.tsx`에 매매 기록 테이블과 "직접 입력" 및 "수정" 버튼을 구현.
    3.  **통합 입/수정 모달**: `add-trade-log-modal.tsx`에서 신규 기록 추가와 기존 기록 수정을 모두 처리하도록 로직을 통합.
    4.  **UX/UI 개선**:
        - **환율 연동**: `CurrencyContext`와 연동하여 테이블과 모달의 모든 금액을 현재 통화(KRW/USD) 설정에 맞게 자동 변환하여 표시. 저장 시에는 KRW로 일관되게 저장.
        - **UI 개선**: 테이블 헤더에 통화 단위를 아이콘으로 표시하고, 모달의 금액 입력창 내부에 통화 아이콘을 추가하여 가독성 향상.
        - **데이터 시각화**: 매도 정보가 없는 항목에 'N/A' 대신 아이콘(`MinusCircle`)을 표시하여 시각적 명확성 개선.
  - **주요 디버깅**:
    - **`NaN` 오류**: API 응답의 숫자 값에 포함된 쉼표(,) 문제. API 라우트에서 쉼표를 제거하여 해결.
    - **데이터 불일치 오류**: API 응답 키(`PascalCase`)와 클라이언트 기대 키(`camelCase`) 불일치 문제. `stock-search.tsx`에서 데이터 키를 변환하여 해결.
    - **Zod 스키마 유효성 검사 오류**:
        - 매도 관련 필드를 모두 비웠을 때 유효성 검사에 실패하는 문제. `z.preprocess`를 사용하여 빈 문자열을 `undefined`로 변환 후 검증하여 해결.
        - "매도량"이 "매수량"보다 많을 수 없도록 `superRefine`을 사용하여 복합 필드 유효성 검사 로직을 추가.
        - **(신규)** "매도일"이 "매수일"보다 이전일 수 없도록 `superRefine` 검증 로직과 캘린더 UI의 `disabled` 속성을 연동하여 처리.
    - **`useEffect` 의존성 배열 오류**: `react-hook-form`의 `form` 객체 전체를 의존성 배열에 포함시켜 발생. 안정적인 `reset` 함수만 추출하여 전달하는 방식으로 해결.

- **(신규) 캘린더 UI 구현 및 스타일링 문제 해결**:
  - **목표**: 날짜 입력 필드를 텍스트에서 캘린더 팝업으로 변경하여 사용자 경험을 개선.
  - **구현 내용**:
    1.  **라이브러리 설치**: `react-day-picker`와 `date-fns`를 프로젝트에 추가.
    2.  **컴포넌트 생성**: `shadcn/ui` 스타일의 `Calendar` 컴포넌트(`calendar.tsx`)를 생성하고, 이를 `Popover`와 조합하여 `add-trade-log-modal.tsx`의 날짜 입력 필드에 적용.
  - **주요 디버깅 (스타일링 충돌)**:
    - **현상**: `react-day-picker` v8 이상으로 업데이트되면서 내부 클래스명과 API 구조가 변경되어, `shadcn/ui`의 기본 캘린더 스타일이 더 이상 호환되지 않아 UI가 깨지는 문제 발생.
    - **최종 해결책**: `react-day-picker` v8+의 변경된 클래스명에 맞춰 `calendar.tsx` 내부의 `classNames` prop을 수동으로 재정의하여 최신 버전에 호환되도록 스타일을 수정. (사용자가 직접 해결)

---

## 5. 향후 개발 계획 (Future Development Plan)

**목표**: 매매 복기 기능의 사용성을 고도화하고 사용자 경험을 개선한다.

### 가. 매매 기록 수정 기능 고도화
- **현황**: 현재 매매 기록 수정 기능이 구현되었으나, UX 개선의 여지가 있음.
- **개발 계획**:
  1.  **수정 모드 명시**: 수정 모달이 열렸을 때, 사용자가 이를 명확히 인지할 수 있도록 UI를 개선 (예: 제목 강조, 버튼 텍스트 변경).
  2.  **변경 불가능 필드 처리**: 수정 시에는 '종목' 관련 정보(종목명, 종목코드)는 변경할 수 없도록 명확하게 비활성화 처리. (현재는 구현됨, UI 개선 필요)

---

## 6. 필수 환경 변수 (`.env.local` - 최종)
*(기존 내용과 동일)*
```
# GitHub OAuth App credentials
AUTH_GITHUB_ID=...
AUTH_GITHUB_SECRET=...

# Secret for signing NextAuth.js tokens
AUTH_SECRET...

# Korea Investment & Securities (KIS) API Key
KIS_APP_KEY=...
KIS_APP_SECRET=...
```
